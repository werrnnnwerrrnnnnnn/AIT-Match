<!-- CSS for the custom search bar with magnifying glass button and 3 buttons under -->
<style>
  /* Main container that wraps the search bar and buttons */
  .container-box {
    border: 2px solid #617952;
    background-color: white;
    border-radius: 20px;
    padding: 20px;
    max-width: 800px;
    margin: 0 auto;
    text-align: center;
  }

  /* Container for the search form */
  .custom-search-bar {
    display: flex;
    align-items: center;
    background-color: #FBCAD0;
    padding: 0px;
    border-radius: 50px;
    width: 100%;
    border: 2px solid #617952;
    transition: all 0.4s ease-in-out;
  }

  /* Search input */
  .custom-search-bar input[type="text"] {
    flex: 1;
    border: none;
    background-color: white;
    padding: 10px 100px;
    margin-left: 7px;
    font-size: 14px;
    border-radius: 50px;
    outline: none;
    transition: all 0.4s ease-in-out;
  }

  .custom-search-bar input[type="text"]::placeholder {
    color: #aaa;
    font-size: 16px;
  }

  /* Style for search button */
  .custom-search-bar button {
    width: 50px;
    height: 50px;
    background-color: #617952;
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: 10px;
    cursor: pointer;
  }

  .custom-search-bar button img {
    width: 20px;
    height: 20px;
  }

  /* Action buttons at the bottom */
  .action-buttons {
    margin-top: 20px;
    display: flex;
    justify-content: center;
    gap: 20px;
  }

  .action-buttons a {
    text-decoration: none;
    color: #617952;
    padding: 10px 30px;
    border-radius: 50px;
    border: 2px solid #617952;
    background-color: white;
    transition: all 0.3s ease;
  }

  .action-buttons a:hover {
    background-color: #617952;
    color: white;
  }

  body {
    margin-top: 80px; /* Adjust this value to match the height of your navbar */
  }

  .main-content {
    padding-top: 80px; /* Adjust this value to match the height of your navbar */
    display: flex;
    justify-content: space-between; /* Aligns the content and sidebar next to each other */
    padding: 20px;
  }

  .profiles-section {
    flex: 2; /* Occupies more space for the profile content */
  }

  .sidebar {
    flex: 1; /* Occupies less space for the sidebar */
    padding: 20px;
    background-color: #617952;  /*background container*/
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    max-width: 300px; /* Sidebar width */
    margin-left: 20px;
  }

  .sidebar h2 {
    background-color: #FDEDF1; /* Dark green background */
    color: #617952;
    padding: 10px;
    border-radius: 5px;
  }

  .sidebar p {
    color: white; /* Match the green theme */
    font-size: 16px;
  }

  /* Style for profile pictures */
  .profile-picture {
    border-radius: 50%;
    object-fit: cover;
  }
</style>

<!-- Main HTML content -->
<div class="main-content">
  <div class="profiles-section">

    <!-- Container wrapping the search bar and the action buttons -->
    <div class="container-box">
    
      <!-- Search form with custom search bar and search button inside -->
      <%= form_with(url: search_profiles_path, method: :get, local: true, html: {class: "custom-search-bar"}) do %>
        <div class="field">
          <%= text_field_tag :username, params[:username], placeholder: "Search by Username", class: "form-control" %>
        </div>
        <!-- Search button -->
        <button type="submit">
          <img src="path_to_your_magnifying_glass_icon" alt="Search">
        </button>
      <% end %>

      <!-- Action buttons with disable_filters, now displayed as buttons under the search bar -->
      <div class="action-buttons">
        <%= link_to 'Show Profiles A-Z', profiles_path(order: 'asc', disable_filters: true), class: "btn btn-secondary" %>
        <%= link_to 'Show Profiles Z-A', profiles_path(order: 'desc', disable_filters: true), class: "btn btn-secondary" %>
        <%= link_to 'Show Profiles Random', profiles_path(order: 'random', disable_filters: true), class: "btn btn-secondary" %>
      </div>
    </div>

    <!-- Display the appropriate heading based on the current state -->
    <% if @no_profiles_found %>
      <h2>No profiles found</h2>
    <% elsif @searching %>
      <h2>Showing results for "<%= params[:username] %>"</h2>
    <% elsif @filtering %>
      <h2>Showing profiles based on your preferences</h2>
    <% elsif @sorted_az %>
      <h2>Showing all profiles by A-Z</h2>
    <% elsif @sorted_za %>
      <h2>Showing all profiles by Z-A</h2>
    <% elsif @showing_random %>
      <h2>Showing all profiles by random</h2>
    <% else %>
      <h2>Showing all profiles</h2>
    <% end %>

    <!-- Profiles Table -->
    <% unless @no_profiles_found %>
      <h1>Profiles</h1>
      <table>
        <thead>
          <tr>
            <th>Profile Picture</th>
            <th>Email</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>User Name</th>
            <th>Age</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @filtered_profiles.each do |profile| %>
            <% unless profile.user == current_user %> <!-- Only show other profiles -->
              <tr>
                <td>
                  <% if profile.profile_picture_url.present? %>
                    <%= image_tag(profile.profile_picture_url, alt: 'Profile Picture', class: 'profile-picture', size: '50x50') %>
                  <% else %>
                    <%= image_tag('default-profile-picture.png', alt: 'Default Profile Picture', class: 'profile-picture', size: '50x50') %>
                  <% end %>
                </td>
                <td><%= profile.user.email %></td>
                <td><%= profile.first_name %></td>
                <td><%= profile.last_name %></td>
                <td><%= profile.user_name %></td>
                <td><%= profile.age %></td>
                <td>
                  <%= link_to 'Show', profile_path(profile) %>
                  <% if current_user.profile != profile && !current_user.profile.sent_matches.exists?(receiver: profile) %>
                    <!-- <%= button_to 'Send Match Request', profile_matches_path(profile, receiver_id: profile.id), method: :post %> -->
                    <%= button_to 'Send Match Request', profile_matches_path(profile_id: profile.id), method: :post %>
                  <% elsif current_user.profile.sent_matches.exists?(receiver: profile) %>
                    <p>Match request already sent.</p>
                  <% end %>
                </td>

              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    <% end %>

  </div>

  <!-- Sidebar Filtered details -->
  <div class="sidebar">
    <% if @searching %>
      <h2>Showing results for "<%= params[:username] %>"</h2>
    <% elsif @filtering && current_user.preference.present? %>
      <h2>You are looking for:</h2>
      <!-- Age -->
      <% if current_user.preference.preferred_min_age.present? && current_user.preference.preferred_max_age.present? %>
        <p>Age: <%= current_user.preference.preferred_min_age %> - <%= current_user.preference.preferred_max_age %></p>
      <% else %>
        <p>Age: - </p>
      <% end %>

      <!-- Gender -->
      <% if current_user.preference.preferred_genders.present? && current_user.preference.preferred_genders.any? %>
        <p>Gender: <%= current_user.preference.preferred_genders.pluck(:label).join(", ") %></p>
      <% else %>
        <p>Gender: - </p>
      <% end %>

      <!-- Interests -->
      <% if current_user.preference.preferred_interests.present? && current_user.preference.preferred_interests.any? %>
        <p>Interests: <%= current_user.preference.preferred_interests.pluck(:name).join(", ") %></p>
      <% else %>
        <p>Interests: - </p>
      <% end %>

      <!-- Relationships -->
      <% if current_user.preference.preferred_relationships.present? && current_user.preference.preferred_relationships.any? %>
        <p>Relationships: <%= current_user.preference.preferred_relationships.pluck(:name).join(", ") %></p>
      <% else %>
        <p>Relationships: - </p>
      <% end %>

      <!-- MBTI -->
      <% if current_user.preference.preferred_mbti.present? && current_user.preference.preferred_mbti.any? %>
        <p>MBTI: <%= current_user.preference.preferred_mbti.pluck(:label).join(", ") %></p>
      <% else %>
        <p>MBTI: - </p>
      <% end %>

      <!-- Schools -->
      <% if current_user.preference.preferred_schools.present? && current_user.preference.preferred_schools.any? %>
        <p>Schools: <%= current_user.preference.preferred_schools.pluck(:name).join(", ") %></p>
      <% else %>
        <p>Schools: - </p>
      <% end %>

      <!-- Programs -->
      <% if current_user.preference.preferred_programs.present? && current_user.preference.preferred_programs.any? %>
        <p>Programs: <%= current_user.preference.preferred_programs.pluck(:name).join(", ") %></p>
      <% else %>
        <p>Programs: - </p>
      <% end %>

      <!-- Degrees -->
      <% if current_user.preference.preferred_degrees.present? && current_user.preference.preferred_degrees.any? %>
        <p>Degrees: <%= current_user.preference.preferred_degrees.pluck(:label).join(", ") %></p>
      <% else %>
        <p>Degrees: - </p>
      <% end %>

    <% elsif @sorted_az %>
      <h2>Showing all profiles by A-Z</h2>
    <% elsif @sorted_za %>
      <h2>Showing all profiles by Z-A</h2>
    <% elsif @showing_random %>
      <h2>Showing all profiles by random</h2>
    <% else %>
      <h2>Showing all profiles</h2>
    <% end %>
  </div>
</div>
